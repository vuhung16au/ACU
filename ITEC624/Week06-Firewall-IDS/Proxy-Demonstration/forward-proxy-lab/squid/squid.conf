# Squid Configuration for Forward Proxy Educational Lab
# Purpose: Demonstrate domain-based access control at application layer

# Network configuration
http_port 3128

# Access Control Lists (ACLs)
# Define which domains are allowed and which are blocked

# ACL: Allow safe/legitimate sites
acl allowed_domains dstdomain allowed-site.com
acl allowed_domains dstdomain www.allowed-site.com

# ACL: Block malicious/unwanted sites
acl blocked_domains dstdomain malicious-site.com
acl blocked_domains dstdomain www.malicious-site.com

# ACL: Standard safe ports for HTTP
acl Safe_ports port 80          # HTTP
acl Safe_ports port 443         # HTTPS
acl CONNECT method CONNECT

# Access Rules (Order matters! First match wins)

# Deny access to blocked domains explicitly
http_access deny blocked_domains

# Allow access to allowed domains
http_access allow allowed_domains

# Deny all other domains (default deny)
http_access deny all

# Logging configuration
# Log format: timestamp | client_ip | http_status | size | method | url
access_log stdio:/var/log/squid/access.log squid

# Cache configuration (minimal for this lab)
cache_dir ufs /var/cache/squid 100 16 256
cache_mem 8 MB
maximum_object_size 4 MB

# Error messages
error_directory /usr/share/squid/errors/en

# DNS configuration
dns_nameservers 127.0.0.11  # Docker's internal DNS

# Visible hostname
visible_hostname squid-forward-proxy

# Disable cache for testing clarity
cache deny all

# Enable detailed access logging
debug_options ALL,1

# Refresh patterns (not critical for this lab)
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

